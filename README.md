# 小学校理科学習支援システム - Science3

小学4年生の理科学習における予想と考察を支援するFlask Webアプリケーションです。AI（OpenAI API）との対話を通じて、産婆法的アプローチにより学習者の既習事項・経験を引き出し、段階別の言語化支援により根拠のある予想・考察の作成を支援します。

## 🎯 主な機能

### 👨‍🎓 学習者用機能
- **クラス選択** - 1組〜4組からの選択
- **出席番号選択** - 各クラス1〜30番からの選択（カード形式UI）
- **学習単元選択** - 小学4年生理科の熱と温度関連単元から選択
- **AI対話支援**
  - **予想段階**: 児童の表現を受容 → 必要に応じて一般表現に変換 → 経験との関連付け → 根拠の明確化
  - **考察段階**: 実験結果の言語化 → 予想との比較 → 経験・既習事項との関連 → 科学的概念への導き
- **自然な表現変換** - 児童のオノマトペや体験的表現を科学的表現に変換
- **経験不足時の支援** - 関連する経験がない場合、AIが具体例を提示
- **家族表現の統一** - 「お母さん」→「お家の人」への自動変換
- **予想文生成**: 対話内容のみを基に学習者の発言をまとめた予想文を提案
- **考察文生成**: 実験結果と予想を比較し、経験と関連付けた考察文を作成

### 👩‍🏫 教員用機能
- **認証システム** - 教員専用ログイン
- **学習ログ閲覧** - 学生の言語化プロセスと学習過程の詳細確認
  - クラス・出席番号・単元・日付別のフィルタリング
  - タイムライン形式での学習過程表示
  - 予想・考察の各段階における対話内容の確認
- **学習進捗管理** - 学生ごとの学習状況一覧
  - 各単元の学習完了状況の把握
  - 学生別の詳細ログへのアクセス

## 📚 対応学習単元

- **金属のあたたまり方** - 金属の熱伝導と温まり方の学習
- **水のあたたまり方** - 液体の対流と温まり方の理解
- **空気の温度と体積** - 気体の性質と温度変化の関係
- **水を熱し続けた時の温度と様子** - 状態変化と温度の関係

## 🛠️ 技術仕様

- **バックエンド**: Flask (Python)
- **AI**: OpenAI API (gpt-4o-mini)
- **フロントエンド**: HTML5, CSS3, JavaScript, Bootstrap 5
- **データ保存**: JSON形式のログファイル（logs/learning_log_YYYYMMDD.json）
- **セッション管理**: Flaskセッション
- **プロンプト管理**: Markdown形式（prompts/単元名.md）
- **UI/UX**: レスポンシブデザイン、モダンなカードレイアウト
- **教員ダッシュボード**: シンプルで見やすいデザイン（グラデーション背景、Grid/Flexboxレイアウト）

## 🚀 セットアップ・起動方法

### 1. 必要なパッケージのインストール
```bash
pip install -r requirements.txt
```

### 2. 環境変数の設定
`.env`ファイルを作成して、OpenAI APIキーを設定：
```env
OPENAI_API_KEY=your_actual_openai_api_key_here
```

### 3. アプリケーションの起動
```bash
python app.py
```

### 4. アクセス
- 学習者用: http://localhost:5014
- 教員用: http://localhost:5014/teacher

## 💡 教育的配慮

### 段階別言語化支援システム
#### 予想段階（概念化は行わない）
1. **体験的表現の受容**: オノマトペや感覚的表現を価値づけ
2. **一般表現への変換**: 「〜を別の言い方でできるかな？」で支援
3. **経験との関連付け**: 日常体験・既習事項の活用
4. **根拠の明確化**: 予想の根拠を言語化

#### 考察段階（概念化への足掛かりまで）
1. **結果の言語化**: 実験結果の体験的表現を受容
2. **一般表現への変換**: 科学的表現への言語化支援
3. **予想との比較**: 「予想と同じ？違った？」
4. **経験・既習事項との関連**: 学習内容の関連付け
5. **概念化への足掛かり**: 「このことから何が言えそう？」

### 産婆法的アプローチ
- AIが答えを誘導せず、学習者の経験を引き出す
- 「なぜそう思うのか」を問いかけて根拠を探る
- 理科の見方・考え方（量的・質的・共通性・時間空間的視点）を活用

### リライト支援機能
- **予想文生成**: 対話内容のみを基に学習者の発言をまとめた予想文を提案
- **考察文生成**: 結果・予想比較・経験関連付けを含む考察文を提案
- **足場かけ**: 紙面記述への移行を支援

### AI支援機能
- **自然な表現変換**: 児童のオノマトペや体験的表現を科学的表現に変換
- **経験不足時の支援**: 関連する経験がない場合、AIが具体例を提示
- **家族表現の統一**: インクルーシブな表現への自動変換
- **プロンプト最適化**: マークダウン記法や特殊記号の自動除去
- **エラーハンドリング**: API呼び出し失敗時の適切な処理

## 🎨 UI/UX特徴

- **クリーンデザイン**: 白ベース・ライトブルーアクセントの小学生向けUI
- **直感的操作**: カード形式の選択とチャット形式の対話
- **レスポンシブデザイン**: スマートフォン・タブレット対応
- **アクセシビリティ**: 小学生にも使いやすいインターフェース
- **教員ダッシュボード**: モダンなグラデーション背景とGridレイアウト

## � 学習ログ管理機能

- **教員ダッシュボード**: モダンなグラデーション背景とGridレイアウト

## 📊 学習ログ管理機能

### 学習記録の閲覧
このシステムは学習者の対話プロセスを詳細に記録し、教員が確認できます。

- **日付別ログ管理**
  - 日付ごとに自動保存される学習ログ
  - 過去のログの閲覧・検索
  
- **フィルタリング機能**
  - 日付、単元、出席番号による絞り込み
  - 複数条件での柔軟な検索

- **詳細な学習過程の確認**
  - タイムライン形式での対話履歴表示
  - 予想・考察各段階での対話内容
  - 学習者の思考プロセスの可視化

### 学習ログの活用
- 個別指導への活用
- 学習者の理解度確認
- 指導改善のための分析データ

## 💡 教育的配慮

## 📊 学習支援分析機能

### AI学習分析
このシステムは「見方・考え方」を働かせる探究活動における学習支援を目的としています。

- **個別学習分析**
  - 学習者一人ひとりの学習プロセスをOpenAI APIが分析
  - **予想段階**: 経験や既習事項の活用状況を確認
  - **考察段階**: 結果の理解、予想との比較、日常生活との関連付けを確認
  - 生成AIとの対話を通じた学習プロセスの支援

- **クラス全体の学習分析**
  - クラス全体の学習傾向把握
  - 共通する学習課題の特定
  - 効果的な学習支援方法の抽出
  - 今後の学習支援提案

### 教育的背景
- **産婆法的アプローチ**: AIが答えを与えず、児童の経験を引き出す
- **個別最適な支援**: 児童の応答レベルに応じた問いかけ
- **本質的理解の促進**: 対話プロセスを通じた思考の構造化

### 学習ログ管理
- 日付別ログファイル自動生成
- 学習者・単元・日付での柔軟なフィルタリング
- 詳細な学習過程の記録（タイムライン形式表示）

## 📁 ディレクトリ構造

```
science-sup/
├── app.py                      # メインアプリケーション
├── requirements.txt            # 依存関係
├── .env                       # 環境変数（要設定）
├── logs/                      # 学習ログ（自動生成）
│   └── learning_log_YYYYMMDD.json
├── prompts/                   # 単元別プロンプト
│   ├── 予想_summary.md         # 予想まとめ用プロンプト
│   ├── 考察_final_summary.md   # 考察まとめ用プロンプト
│   ├── 空気の温度と体積.md      # 各単元専用プロンプト
│   ├── 金属のあたたまり方.md
│   ├── 水のあたたまり方.md
│   └── 水を熱し続けた時の温度と様子.md
├── templates/                 # HTMLテンプレート
│   ├── base.html
│   ├── index.html
│   ├── select_class.html
│   ├── select_number.html
│   ├── select_unit.html
│   ├── prediction.html
│   ├── experiment.html
│   ├── reflection.html
│   └── teacher/               # 教員用テンプレート
│       ├── login.html
│       ├── dashboard.html
│       ├── logs.html
│       └── student_detail.html
├── static/                    # 静的ファイル
│   └── css/
│       └── style.css          # モダンなデザイン（グラデーション、Grid/Flexbox）
└── tasks/                     # 単元別課題文
    ├── 空気の温度と体積.txt
    ├── 金属のあたたまり方.txt
    ├── 水のあたたまり方.txt
    └── 水を熱し続けた時の温度と様子.txt
```

##  データ形式

### 学習ログ構造
```json
{
  "timestamp": "2025-08-14T10:30:00.000000",
  "student_number": "1",
  "unit": "空気の温度と体積",
  "log_type": "prediction_chat",
  "data": {
    "user_message": "学習者の入力",
    "ai_response": "AIの応答",
    "conversation_count": 1,
    "used_suggestion": false,
    "suggestion_index": null
  }
}
```

### ログタイプ
- `prediction_chat`: 予想段階の対話
- `prediction_summary`: 予想のまとめ（リライト支援）
- `reflection_chat`: 考察段階の対話
- `final_summary`: 最終考察（リライト支援）

### プロンプトファイル構造（段階別言語化支援対応）
```markdown
# 単元名 - 対話プロンプト

## 役割設定
あなたは小学生向けの産婆法を実践する理科指導者です。

## 言語化支援の重要な視点
### 段階的言語表現の支援
1. 体験的表現の受容
2. 一般表現への変換
3. 科学的概念への発展

### 理科の見方・考え方の活用
- 量的・関係的視点、質的・実体的視点
- 共通性・多様性視点、時間的・空間的視点

## 対話の進め方（段階別）
### 予想段階での対話
1-4回目: 体験受容→一般表現変換→経験関連付け→根拠明確化

### 考察段階での対話
1-5回目: 結果言語化→一般表現変換→予想比較→経験関連→概念化足掛かり

## 単元固有の指導ポイント
- 重要な概念や注意点

## 学習者が理解すべき概念
- 理解すべき内容
```

## 🔬 言語化支援の特徴

### オノマトペ→一般表現→科学的概念の段階的支援
```
「ぶくぶく」→「泡が出ている」→「水蒸気が発生している」
「パンパン」→「ふくらんでいる」→「体積が大きくなっている」
「じりじり」→「だんだん熱くなる」→「熱伝導により温度が上昇」
```

### 対話例：予想段階
```
児童: 「風船がパンパンになると思う」
AI: 「パンパンを別の言い方でできないかな？」
児童: 「大きくなる」
AI: 「夏のタイヤで似たような経験はない？」
児童: 「タイヤも大きくなってた」
AI: 「なぜそう思ったの？」
```

### 対話例：考察段階
```
児童: 「実験で風船がパンパンになった」
AI: 「パンパンを別の言い方でできるかな？」
児童: 「ふくらんだ」
AI: 「予想と同じだった？」
児童: 「同じだった」
AI: 「このことから空気について何が言えそう？」
```

## 想定される対話の流れ
児童: 「ふくらんだ」  
AI: 「予想と同じだった？」  
児童: 「同じだった」  
AI: 「このことから空気について何が言えそう？」

## 日常生活との関連
- 身近な例との関連付け
- 実体験に基づく理解の促進
```

## 🚨 注意事項

- **APIキー管理**: `.env`ファイルのOpenAI APIキーは適切に管理してください
- **認証システム**: 本番運用時は適切な教員認証システムを実装してください
- **ポート設定**: デフォルトポートは5014です（app.py最下部で変更可能）
- **データ保存**: 学習ログは`logs/`ディレクトリに日付別で自動保存されます
- **プロンプト管理**: プロンプトファイルは`prompts/`ディレクトリに単元別で保存されます
- **セッション管理**: Flaskセッションを使用（本番環境では適切なSecret Keyに変更）

## 🎓 開発・カスタマイズ

- **単元追加**: `tasks/`ディレクトリに新しい課題文ファイルを追加し、対応するプロンプトファイルを`prompts/`に作成
- **スタイル変更**: `static/css/style.css`でデザインをカスタマイズ
- **AI応答調整**: `prompts/`ディレクトリ内の各単元プロンプトを編集

## 🆕 最新アップデート（2025年10月16日）

- **教員ダッシュボードの完全リニューアル**: シンプルで見やすいデザインに刷新
  - モダンなグラデーション背景
  - Grid/Flexboxによるレスポンシブレイアウト
  - カード形式の機能メニュー
- **機能のシンプル化**: 複雑な分析機能を削除し、学習ログ閲覧に集中
  - 教員用分析機能の削除
  - 不要なルートとテンプレートの削除
- **コードの最適化**: メンテナンス性の向上
- **OpenAI API統合の改善**: メッセージ形式の最適化によるレスポンス品質向上

## � クイックスタート

```bash
# リポジトリのクローン
git clone https://github.com/nov11masaki/science3.git
cd science3

# 依存関係のインストール
pip install -r requirements.txt

# 環境変数の設定（.envファイルを作成）
echo "OPENAI_API_KEY=your_openai_api_key_here" > .env

# アプリケーションの起動
python app.py
```

その後、ブラウザで http://localhost:5014 にアクセスしてください。

## 🔗 関連技術

- **Flask**: Pythonウェブフレームワーク
- **OpenAI API**: GPT-4o-mini による自然言語処理
- **Bootstrap 5**: レスポンシブWebデザイン
- **産婆法的アプローチ**: 教育哲学に基づく対話支援

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

---

**Science3** - 小学校理科教育における予想・考察支援システム  
AI技術を活用した段階別言語化支援により、児童の科学的思考力を育成します。
