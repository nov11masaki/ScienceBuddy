# 🔬 ScienceBuddy（サイエンスバディ）

小学4年生の理科学習で「変化」に着目させるAI対話型Webアプリケーション。子どもと一緒に実験の結果を観察し、「何が変わった？」という問いから科学的思考を育みます。

---

## 📖 プロダクト概要

### 何ができるアプリか
ScienceBuddy は、小学校理科の学習過程において、子ども達が**「変化」に気づき、その理由を考え、日常と結びつける**のをAIが支援します。

- 📝 **予想段階**: 子どもの経験から「どう変わると思う？」という根拠を引き出す
- 🔍 **実験段階**: 児童が実験を実施して「何が変わったか」を観察
- 💭 **考察段階**: 実際の変化と予想を比較しながら、新しい理解を形成
- 📋 **記録**: 全ての対話と学習過程をログに記録

### 教育的アプローチ
子どもの **「あ、変わった！」という気づき** を大切にしながら、自然な対話の中で科学的思考を育みます。

---

## 🎯 主な機能

### 👨‍🎓 学習者用機能
- **クラス選択** - 1組〜4組からの選択
- **出席番号選択** - 各クラス1〜30番からの選択（カード形式UI）
- **学習単元選択** - 小学4年生理科の熱と温度関連単元から選択

#### 📱 AI対話支援（チャット形式）
- **予想段階**: 
  - 子どもの予想を受け止める
  - 理由や経験を自然に引き出す
  - 1つ出た経験を深く掘り下げる
  
- **考察段階**:
  - 実験結果を受け止める
  - 予想と比べる（「当たった？」「どこが違う？」）
  - なぜそうなったか考える（ソクラテス問答）
  - 日常生活とつなげる（1つで十分）

#### 📝 対話結果の要約
- 対話内容から自動的に予想・考察文を提案
- テンプレート形式に固執しない **子ども本位の要約**
- 子どもの言葉や表現を活かす（「ボコボコ」「〜みたい」など）

#### 🎤 多様な入力方法
- **キーボード入力** - 標準的なテキスト入力
- **タッチ50音表** - スマートフォン対応のひらがなキーボード
- **フリック入力** - スマホライクな入力方式
- **音声入力** - リアルタイム音声認識（Chrome、Safari対応）

#### 🎨 使いやすいUI
- チャット形式の対話画面
- 50音表オン/オフ切り替えで画面最適化
- 入力エリアのアニメーション
- モバイルフレンドリーデザイン

### 👩‍🏫 教員用機能
- **認証システム** - 教員専用ログイン
- **学習ログ確認** - 学生の対話プロセス詳細表示
  - タイムライン形式での学習過程
  - 予想・考察の各段階での対話内容
  - クラス・出席番号・単元・日付でフィルタリング可能
- **学習進捗管理** - 学生ごとの学習状況把握
  - 各単元の完了状況
  - 学生の詳細ログへのアクセス

---

## 📚 対応学習単元（小学4年生 熱と温度）

| 単元 | 主な学習内容 |
|------|-----------|
| 🔥 **金属のあたたまり方** | 金属の熱伝導と温まり方 |
| 💧 **水のあたたまり方** | 液体の対流と温まり方 |
| 💨 **空気の温度と体積** | 気体の性質と温度変化 |
| 🌡️ **水を熱し続けた時の温度と様子** | 状態変化と温度の関係 |

---

## 🛠️ 技術仕様

| カテゴリ | 技術スタック |
|--------|-----------|
| **バックエンド** | Flask (Python 3.9+) |
| **AI** | OpenAI API (gpt-4o-mini) |
| **フロントエンド** | HTML5, CSS3, JavaScript, Bootstrap 5 |
| **データ保存** | JSON形式ログ |
| **セッション管理** | Flask Session |
| **プロンプト** | Markdown形式 |
| **デザイン** | レスポンシブ・モダンUI |

---

## 🚀 セットアップ・起動方法

### 1. パッケージのインストール
```bash
pip install -r requirements.txt
```

### 2. 環境変数の設定
`.env`ファイルを作成：
```env
OPENAI_API_KEY=your_actual_openai_api_key_here
```

### 3. アプリケーション起動
```bash
python app.py
```

### 4. アクセス
- **学習者用**: http://localhost:5014
- **教員用**: http://localhost:5014/teacher

---

## 💡 教育的配慮・設計哲学

### 「変化」に着目させる対話
#### 基本的な考え方
科学学習の第一歩は、**「何が変わったのか」に気づくこと**です。ScienceBuddy では、子どもが実験を通じて観察した「変化」を中心に対話を進めます。

#### 対話の進め方
1. **予想段階**: 「どう変わると思う？」と子どもの予想を引き出す
2. **実験段階**: 子どもが実際に実験して「何が変わったか」を観察
3. **考察段階**: 
   - 実際の変化と予想を比較する
   - 「何が変わった？」「どこが違った？」という問いを通じて理解を深める
   - 日常生活の中で似たような「変化」を見つけさせる

#### AI対話の姿勢
- **子どもが言ったことを最優先** - テンプレートに固執しない
- **変化に焦点を当てる** - 「どう変わった？」という問いで思考を促す
- **自然な会話** - 短く、わかりやすい言葉で、子どもと一緒に観察する感覚で対話
- **経験を深く掘り下げる** - 1つの経験から、その背景にある「変化」の理由を考えさせる
- **子どもらしい表現を尊重** - 「ボコボコ」「パンパン」などの言葉もそのまま活かす

#### 考察段階での流れ例
```
AI: 「実験でどんな変化があった？」
子ども: 「タイヤがパンパンになった」
AI: 「なるほど、タイヤがパンパンになったんだね」
AI: 「最初の予想では、どう変わると思ってた？」
子ども: 「ちょっと大きくなると思ってた」
AI: 「へえ、ちょっと大きくなるって思ってたけど、実際は？」
子ども: 「ものすごく大きくなった」
AI: 「そっか、想像以上に大きくなったんだ。」
AI: 「そういう『すごく大きくなる』ことって、日常生活でも見たことある？」
子ども: 「夏、自転車のタイヤが硬くなる」
```

### 要約作成の特徴
- **子どもが話した内容と順序を最優先** - テンプレート形式に固執しない
- **「変化」を中心に** - 子どもが観察した変化を明確に記述
- **子どもらしい表現を残す**
  - 「気がする」「〜みたい」などの曖昧な表現もOK
  - 「ボコボコ」などの擬音語もそのまま活かす
  - 「パンパン」「ペコペコ」などのオノマトペも尊重
- **話した順序を尊重** - 子どもが自然に話した流れをそのまま活かす

**要約例（子どもの観察を中心に）**:
- 「夏の日にタイヤがパンパンになった。だから、あたためるとタイヤが大きくなると思った。」
- 「やかんでお湯をわかしたとき、ボコボコしてきて湯気が出た。温度が上がるとこんなに変わるんだ。」
- 「水をあたためると、上の方があたたかくなった。ずっと下はつめたかった。」

### 重要な注意事項
1. **「変化」を中心に** - 子どもが見た・観察した「変化」を大切にする
2. **経験は1つで十分** - 無理に複数聞き出さない。1つの経験を深く掘り下げる
3. **子どもの考えを尊重** - 科学的に完璧でなくても、子どもなりの気づきを大切に
4. **予想と結果の比較を大切に** - 「当たった？」「どこが違う？」という問いで思考を促す
5. **柔軟に対応** - 指示は目安。子どもの反応に合わせて自然に会話する

## 🎨 UI/UX特徴

### デザイン
- **クリーンデザイン**: 白ベース・ライトブルーアクセントの小学生向けUI
- **直感的操作**: カード形式の選択とチャット形式の対話
- **レスポンシブデザイン**: スマートフォン・タブレット対応
- **アクセシビリティ**: 小学生にも使いやすいインターフェース
- **教員ダッシュボード**: モダンなグラデーション背景とGridレイアウト

### 入力エリアの最適化

#### デフォルト設定
- **50音表**: OFF（チャット画面を最大化）
- **音声入力**: OFF（キーボード操作を優先）
- **入力エリア**: コンパクト表示（アバター 32px、フォント 0.75rem）

#### 50音表 OFF 時
- **入力エリア高さ**: 12vh（コンパクト）
- **チャット領域**: 約88vh（最大化）
- **入力アバター**: 32px
- **入力フォント**: 0.75rem

#### 50音表 ON 時
- **入力エリア高さ**: 45vh（通常）
- **チャット領域**: 約55vh
- **入力アバター**: 42px
- **入力フォント**: 0.95rem

#### アニメーション
- **トグル時**: スムーズな transitionアニメーション（0.4s ease-out）
- **slideDown**: 50音表 OFF 時の縮小アニメーション
- **slideUp**: 50音表 ON 時の拡大アニメーション

### 多様な入力方法
- **キーボード入力**（標準）
- **タッチキーボード**（ひらがな50音配列、トグル ON/OFF）
- **フリック入力**（スマホライク）
- **音声入力**（リアルタイム認識、トグル ON/OFF）
  - 話しながら随時テキストに変換
  - 継続的な音声認識で自然な入力
  - Chrome、Edge、Safari対応

## 📊 学習ログ管理機能

### 学習記録の閲覧
このシステムは学習者の対話プロセスを詳細に記録し、教員が確認できます。

- **日付別ログ管理**
  - 日付ごとに自動保存される学習ログ
  - 過去のログの閲覧・検索
  
- **フィルタリング機能**
  - 日付、単元、出席番号による絞り込み
  - 複数条件での柔軟な検索

- **詳細な学習過程の確認**
  - タイムライン形式での対話履歴表示
  - 予想・考察各段階での対話内容
  - 学習者の思考プロセスの可視化

### 学習ログの活用
- 個別指導への活用
- 学習者の理解度確認
- 指導改善のための分析データ

## 📁 ディレクトリ構造

```
science3/
├── app.py                      # メインアプリケーション
├── requirements.txt            # 依存関係
├── .env                       # 環境変数（要設定）
├── logs/                      # 学習ログ（自動生成）
│   └── learning_log_YYYYMMDD.json
├── prompts/                   # 単元別プロンプト（全ての指示が含まれる）
│   ├── 金属のあたたまり方.md
│   ├── 水のあたたまり方.md
│   ├── 空気の温度と体積.md
│   └── 水を熱し続けた時の温度と様子.md
├── templates/                 # HTMLテンプレート
│   ├── base.html
│   ├── index.html
│   ├── select_class.html
│   ├── select_number.html
│   ├── select_unit.html
│   ├── prediction.html
│   ├── experiment.html
│   ├── reflection.html
│   └── teacher/               # 教員用テンプレート
│       ├── login.html
│       ├── dashboard.html
│       ├── logs.html
│       └── student_detail.html
├── static/                    # 静的ファイル
│   └── css/
│       └── style.css
├── tasks/                     # 単元別課題文
│   ├── 金属のあたたまり方.txt
│   ├── 水のあたたまり方.txt
│   ├── 空気の温度と体積.txt
│   └── 水を熱し続けた時の温度と様子.txt
└── docs/                      # ドキュメント
    ├── README.md
    └── 教員用ページアクセス方法.md
```

## 📊 データ形式

### 学習ログ構造
```json
{
  "timestamp": "2025-10-21T10:30:00.000000",
  "student_number": "1",
  "class_number": "class1",
  "unit": "空気の温度と体積",
  "log_type": "prediction_chat",
  "data": {
    "user_message": "学習者の入力",
    "ai_response": "AIの応答",
    "conversation_count": 1
  }
}
```

### ログタイプ
- `prediction_chat`: 予想段階の対話
- `prediction_summary`: 予想のまとめ
- `reflection_chat`: 考察段階の対話
- `final_summary`: 最終考察

### プロンプトファイル構造（CIIO形式）
各単元のプロンプトファイルは**CIIO形式**で統一されています：

```markdown
## 📚 Context（背景・前提）
- 学習内容（単元、学年、学習段階）
- 教育方針（ソクラテス問答法、子ども中心、自然な対話）
- 前提知識（語彙力、漢字制限、専門用語の扱い）

## 🎯 Instruction（指示・命令）
- 絶対に守るべき原則（5つ）
- 対話の進め方（予想段階・考察段階）
- 禁止事項

## 📥 Input Data（入力データ・参考データ）
- 児童からの入力
- 児童の経験例
- 要約作成時の参考データ（複数の要約例）

## 📤 Output Indicator（出力条件・出力基準）
- 出力形式（1往復ごと、自然な対話文）
- 出力のタイミング（通常の応答、要約）
- 出力品質基準（小学3年生までの漢字のみ使用）
```

**重要な特徴**:
- すべての指示がプロンプトファイルに集約
- app.pyでは余計な指示を追加しない
- プロンプトファイルの編集だけで対話方針を変更可能

## 🔬 対話の特徴

### 自然な質問の工夫
AIは形式的な質問ではなく、自然な会話を心がけます：

| ❌ 避けたい聞き方 | ✅ 自然な聞き方 |
|-----------------|---------------|
| 「関係があるのかな？」 | 「それって、〇〇と似てる？」 |
| 「どんなふうに関係していると思う？」 | 「どんなふうに変わったと思う？」 |
| 「どうしてそう思うの？」 | 「そう思ったのは、前に見たことがあるから？」 |
| 「なぜそうなると思う？」 | 具体的な事象を問う質問 |
| 「それは関係ある？」 | 「それと同じようなこと、ほかにもある？」 |

### 対話例：予想段階
```
AI: 「金属はどんな風にあたたまっていくかな？」
子ども: 「火の近くから」
AI: 「なるほど、火の近くからだと思うんだね」
AI: 「それはどうしてそう思ったの？」
子ども: 「スプーンを熱いコーヒーに入れたとき、持ち手まで温まったから」
AI: 「そのとき、どうなってたの？」
子ども: 「最初は先だけ熱くて、だんだん持ち手も熱くなった」
```

### 対話例：考察段階
```
AI: 「実験でどんな結果になった？」
子ども: 「火の近くから順番に温まった」
AI: 「へえ、火の近くから順番に温まったんだね」
AI: 「最初に思ってたのと同じだった？」
子ども: 「同じだった」
AI: 「普段の生活でも同じようなことってある？」
子ども: 「フライパンの取っ手が熱くなる」
```

## 🚨 注意事項

- **APIキー管理**: `.env`ファイルのOpenAI APIキーは適切に管理してください
- **認証システム**: 本番運用時は適切な教員認証システムを実装してください
- **ポート設定**: デフォルトポートは5014です（app.py最下部で変更可能）
- **データ保存**: 学習ログは`logs/`ディレクトリに日付別で自動保存されます
- **プロンプト管理**: プロンプトファイルは`prompts/`ディレクトリに単元別で保存されます
- **セッション管理**: Flaskセッションを使用（本番環境では適切なSecret Keyに変更）

## 🎓 開発・カスタマイズ

- **単元追加**: `tasks/`ディレクトリに新しい課題文ファイルを追加し、`prompts/`に対応するプロンプトファイルを作成
- **スタイル変更**: `static/css/style.css`でデザインをカスタマイズ
- **AI応答調整**: `prompts/`ディレクトリ内の各単元プロンプトを編集
- **対話方針変更**: 各プロンプトファイルの「基本姿勢」「対話の進め方」セクションを編集

## 🆕 最新アップデート

- **リアルタイム音声入力機能** - 話しながら随時テキスト変換（Chrome、Edge、Safari対応）
- **柔軟な要約生成** - 子どもの自然な話し言葉をそのまま尊重（テンプレート非依存）
- **CIIO形式プロンプト** - 全5単元のプロンプトファイルをCIIO形式に統一
- **コード簡素化** - app.pyから冗長な指示を削除、プロンプトファイルに一元化
- **学習段階の最適化** - 予想段階・考察段階の2段階（実験計画段階は削除）
- **漢字制限の明確化** - AIは小学3年生までの漢字のみ使用
- **対話方針の強化**
  - 1つの経験を深く掘り下げる方針を明記
  - 子どもの言葉を最優先する姿勢を強化
  - 要約で子どもらしい表現（「気がする」「ボコボコ」など）を尊重

## � クイックスタート

```bash
# リポジトリのクローン
git clone https://github.com/nov11masaki/science3.git
cd science3

# 依存関係のインストール
pip install -r requirements.txt

# 環境変数の設定（.envファイルを作成）
echo "OPENAI_API_KEY=your_openai_api_key_here" > .env

# アプリケーションの起動
python app.py
```

その後、ブラウザで http://localhost:5014 にアクセスしてください。

## 🔗 関連技術

- **Flask**: Pythonウェブフレームワーク
- **OpenAI API**: GPT-4o-mini による自然言語処理
- **Bootstrap 5**: レスポンシブWebデザイン
- **対話型学習**: 子どもの「気づき」を大切にする教育設計

---
