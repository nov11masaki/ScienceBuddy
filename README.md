# 小学校理科学習支援システム - Science3

小学4年生の理科学習における予想と考察を支援するFlask Webアプリケーションです。AI（OpenAI API）との対話を通じて、ソクラテス問答法により学習者の経験を引き出し、子どもに寄り添った対話で根拠のある予想・考察の作成を支援します。

## 🎯 主な機能

### 👨‍🎓 学習者用機能
- **クラス選択** - 1組〜4組からの選択
- **出席番号選択** - 各クラス1〜30番からの選択（カード形式UI）
- **学習単元選択** - 小学4年生理科の熱と温度関連単元から選択
- **AI対話支援**
  - **予想段階**: 子どもの予想を受け止め → 理由や経験を引き出す（1つで十分） → 経験を深く掘り下げる
  - **考察段階**: 実験結果を受け止める → 予想と比べる → なぜそうなったか考える → 日常生活とつなげる（1つで十分）
- **ソクラテス問答法**: 答えを教えず、質問で導き、自分で気づかせる
- **子どもに寄り添った対話**: 短く分かりやすい言葉、自然な会話、子どもの言葉を尊重
- **1つの経験で十分**: 無理に複数の経験を聞き出さず、1つの経験を深く掘り下げる
- **要約生成**: 対話内容を基に、子どもの言葉を活かした予想・考察文を提案

### 👩‍🏫 教員用機能
- **認証システム** - 教員専用ログイン
- **学習ログ閲覧** - 学生の対話プロセスと学習過程の詳細確認
  - クラス・出席番号・単元・日付別のフィルタリング
  - タイムライン形式での学習過程表示
  - 予想・考察の各段階における対話内容の確認
- **学習進捗管理** - 学生ごとの学習状況一覧
  - 各単元の学習完了状況の把握
  - 学生別の詳細ログへのアクセス

## 📚 対応学習単元

- **金属のあたたまり方** - 金属の熱伝導と温まり方の学習
- **水のあたたまり方** - 液体の対流と温まり方の理解
- **空気の温度と体積** - 気体の性質と温度変化の関係
- **水を熱し続けた時の温度と様子** - 状態変化と温度の関係

## 🛠️ 技術仕様

- **バックエンド**: Flask (Python)
- **AI**: OpenAI API (gpt-4o-mini)
- **フロントエンド**: HTML5, CSS3, JavaScript, Bootstrap 5
- **データ保存**: JSON形式のログファイル（logs/learning_log_YYYYMMDD.json）
- **セッション管理**: Flaskセッション
- **プロンプト管理**: Markdown形式（prompts/単元名.md）
- **UI/UX**: レスポンシブデザイン、モダンなカードレイアウト
- **教員ダッシュボード**: シンプルで見やすいデザイン（グラデーション背景、Grid/Flexboxレイアウト）

## 🚀 セットアップ・起動方法

### 1. 必要なパッケージのインストール
```bash
pip install -r requirements.txt
```

### 2. 環境変数の設定
`.env`ファイルを作成して、APIキーを設定：
```env
OPENAI_API_KEY=your_actual_openai_api_key_here
```

**注意**: 
- OPENAI_API_KEYは必須（学習支援機能で使用）

### 3. アプリケーションの起動
```bash
python app.py
```

### 4. アクセス
- 学習者用: http://localhost:5014
- 教員用: http://localhost:5014/teacher

## 💡 教育的配慮

### ソクラテス問答法による対話支援
#### 基本姿勢（最重要）
1. **子どもが言ったことを最優先する**
   - 子どもの発言をそのまま受け止め、そこから会話を広げる
   - テンプレートや型にはめようとしない
   - 子どもの言葉、表現、考え方を尊重する
   - **1つ経験が出せていたら、それ以上は求めない** - 無理に複数の経験を聞き出さない

2. **ソクラテス問答法で深める**
   - **答えを教えない** - 「正解は〇〇です」ではなく、質問で気づきを促す
   - **質問で導く** - 子どもの発言を受けて、さらに深く考える質問をする
   - **自分で気づかせる** - 「あ、そうか！」という発見の喜びを大切にする

3. **自然な会話を心がける**
   - 短く、わかりやすい言葉で話す
   - 専門用語は使わず、小学生が理解できる言葉で
   - 誤字、話し言葉は自然に訂正しながら受け止める

#### 予想段階での対話
1. 子どもの予想を受け止める
2. 理由や経験を引き出す（1つで十分）
3. 出てきた経験を深く掘り下げる
4. 経験がない場合はヒントを提示（1つ出たら十分）

#### 考察段階での対話
1. 結果を受け止める
2. 予想と比べる
3. なぜそうなったか考える
4. 日常生活とつなげる（1つで十分）

### 要約作成の特徴
- **子どもが話した内容が中心** - テンプレート通りである必要はない
- 子どもの言葉を活かしながら、書き言葉に整える
- 口語（「〜って」「〜だから」）→ 書き言葉（「〜と」「〜ため」）
- 子どもらしい表現は残す

### 重要な注意事項
1. **要約は最後だけ** - 会話の途中では要約しない
2. **経験は1つで十分** - 無理に複数聞き出さない。1つの経験を深く掘り下げる
3. **子どもの考えを尊重** - 科学的に完璧でなくても、子どもなりの気づきを大切に
4. **無理に誘導しない** - 子どもが思いつかないことを無理に言わせない
5. **柔軟に対応** - 指示は目安。子どもの反応に合わせて自然に会話する

## 🎨 UI/UX特徴

- **クリーンデザイン**: 白ベース・ライトブルーアクセントの小学生向けUI
- **直感的操作**: カード形式の選択とチャット形式の対話
- **レスポンシブデザイン**: スマートフォン・タブレット対応
- **アクセシビリティ**: 小学生にも使いやすいインターフェース
- **教員ダッシュボード**: モダンなグラデーション背景とGridレイアウト

## 📊 学習ログ管理機能

### 学習記録の閲覧
このシステムは学習者の対話プロセスを詳細に記録し、教員が確認できます。

- **日付別ログ管理**
  - 日付ごとに自動保存される学習ログ
  - 過去のログの閲覧・検索
  
- **フィルタリング機能**
  - 日付、単元、出席番号による絞り込み
  - 複数条件での柔軟な検索

- **詳細な学習過程の確認**
  - タイムライン形式での対話履歴表示
  - 予想・考察各段階での対話内容
  - 学習者の思考プロセスの可視化

### 学習ログの活用
- 個別指導への活用
- 学習者の理解度確認
- 指導改善のための分析データ

## 📁 ディレクトリ構造

```
science3/
├── app.py                      # メインアプリケーション
├── requirements.txt            # 依存関係
├── .env                       # 環境変数（要設定）
├── logs/                      # 学習ログ（自動生成）
│   └── learning_log_YYYYMMDD.json
├── prompts/                   # 単元別プロンプト（全ての指示が含まれる）
│   ├── 金属のあたたまり方.md
│   ├── 水のあたたまり方.md
│   ├── 空気の温度と体積.md
│   └── 水を熱し続けた時の温度と様子.md
├── templates/                 # HTMLテンプレート
│   ├── base.html
│   ├── index.html
│   ├── select_class.html
│   ├── select_number.html
│   ├── select_unit.html
│   ├── prediction.html
│   ├── experiment.html
│   ├── reflection.html
│   └── teacher/               # 教員用テンプレート
│       ├── login.html
│       ├── dashboard.html
│       ├── logs.html
│       └── student_detail.html
├── static/                    # 静的ファイル
│   └── css/
│       └── style.css
├── tasks/                     # 単元別課題文
│   ├── 金属のあたたまり方.txt
│   ├── 水のあたたまり方.txt
│   ├── 空気の温度と体積.txt
│   └── 水を熱し続けた時の温度と様子.txt
└── docs/                      # ドキュメント
    ├── README.md
    └── 教員用ページアクセス方法.md
```

## 📊 データ形式

### 学習ログ構造
```json
{
  "timestamp": "2025-10-21T10:30:00.000000",
  "student_number": "1",
  "class_number": "class1",
  "unit": "空気の温度と体積",
  "log_type": "prediction_chat",
  "data": {
    "user_message": "学習者の入力",
    "ai_response": "AIの応答",
    "conversation_count": 1
  }
}
```

### ログタイプ
- `prediction_chat`: 予想段階の対話
- `prediction_summary`: 予想のまとめ
- `reflection_chat`: 考察段階の対話
- `final_summary`: 最終考察

### プロンプトファイル構造
各単元のプロンプトファイルには以下が含まれます：
```markdown
# あなたの役割
小学4年生の理科学習を支援するAIアシスタント

# 基本姿勢（最重要）
1. 子どもが言ったことを最優先する
2. ソクラテス問答法で深める
3. 自然な会話を心がける

# 予想段階での対話
初めの問いかけと対話の進め方

# 考察段階での対話
初めの問いかけと対話の進め方

# 子どもの経験例
会話の中で自然に使う具体例

# 自然な質問の工夫
避けたい聞き方と自然な聞き方の対比表

# 要約を作るとき
子どもの言葉を活かした要約の作り方

# 重要な注意事項
1. 要約は最後だけ
2. 経験は1つで十分
3. 子どもの考えを尊重
4. 無理に誘導しない
5. 柔軟に対応
6. マークダウン記法は使わない
```

## 🔬 対話の特徴

### 自然な質問の工夫
AIは形式的な質問ではなく、自然な会話を心がけます：

| ❌ 避けたい聞き方 | ✅ 自然な聞き方 |
|-----------------|---------------|
| 「関係があるのかな？」 | 「それって、〇〇と似てる？」 |
| 「どんなふうに関係していると思う？」 | 「どんなふうに変わったと思う？」 |
| 「どうしてそう思うの？」 | 「そう思ったのは、前に見たことがあるから？」 |
| 「なぜそうなると思う？」 | 具体的な事象を問う質問 |
| 「それは関係ある？」 | 「それと同じようなこと、ほかにもある？」 |

### 対話例：予想段階
```
AI: 「金属はどんな風にあたたまっていくかな？」
子ども: 「火の近くから」
AI: 「なるほど、火の近くからだと思うんだね」
AI: 「それはどうしてそう思ったの？」
子ども: 「スプーンを熱いコーヒーに入れたとき、持ち手まで温まったから」
AI: 「そのとき、どうなってたの？」
子ども: 「最初は先だけ熱くて、だんだん持ち手も熱くなった」
```

### 対話例：考察段階
```
AI: 「実験でどんな結果になった？」
子ども: 「火の近くから順番に温まった」
AI: 「へえ、火の近くから順番に温まったんだね」
AI: 「最初に思ってたのと同じだった？」
子ども: 「同じだった」
AI: 「普段の生活でも同じようなことってある？」
子ども: 「フライパンの取っ手が熱くなる」
```

## 🚨 注意事項

- **APIキー管理**: `.env`ファイルのOpenAI APIキーは適切に管理してください
- **認証システム**: 本番運用時は適切な教員認証システムを実装してください
- **ポート設定**: デフォルトポートは5014です（app.py最下部で変更可能）
- **データ保存**: 学習ログは`logs/`ディレクトリに日付別で自動保存されます
- **プロンプト管理**: プロンプトファイルは`prompts/`ディレクトリに単元別で保存されます
- **セッション管理**: Flaskセッションを使用（本番環境では適切なSecret Keyに変更）

## 🎓 開発・カスタマイズ

- **単元追加**: `tasks/`ディレクトリに新しい課題文ファイルを追加し、`prompts/`に対応するプロンプトファイルを作成
- **スタイル変更**: `static/css/style.css`でデザインをカスタマイズ
- **AI応答調整**: `prompts/`ディレクトリ内の各単元プロンプトを編集
- **対話方針変更**: 各プロンプトファイルの「基本姿勢」「対話の進め方」セクションを編集

## 🆕 最新アップデート（2025年10月21日）

- **プロンプトシステムの完全統合**: 全ての指示を単元別プロンプトファイルに統合
  - `docs/ソクラテス問答法とは.md` を削除（各プロンプトの「基本姿勢」に統合）
  - `docs/生成AIへの統合指示書.md` を削除（既に統合済み）
  - 各単元のプロンプトファイルだけで完全に機能
- **対話方針の明確化**: ソクラテス問答法に基づく子ども中心の対話
  - 1つの経験を深く掘り下げる方針を明記
  - 子どもの言葉を最優先する姿勢を強化
- **不要な関数の削除**: `load_markdown_content()` など使用されていない関数を削除
- **コードのシンプル化**: メンテナンス性の向上

## � クイックスタート

```bash
# リポジトリのクローン
git clone https://github.com/nov11masaki/science3.git
cd science3

# 依存関係のインストール
pip install -r requirements.txt

# 環境変数の設定（.envファイルを作成）
echo "OPENAI_API_KEY=your_openai_api_key_here" > .env

# アプリケーションの起動
python app.py
```

その後、ブラウザで http://localhost:5014 にアクセスしてください。

## 🔗 関連技術

- **Flask**: Pythonウェブフレームワーク
- **OpenAI API**: GPT-4o-mini による自然言語処理
- **Bootstrap 5**: レスポンシブWebデザイン
- **ソクラテス問答法**: 教育哲学に基づく対話支援

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

---

**Science3** - 小学校理科教育における予想・考察支援システム  
ソクラテス問答法を活用し、子どもに寄り添った対話で科学的思考力を育成します。


予想をしたのちに，計画について
->タイヤがパンパンになることは難しいよねなどどう実験すると良いかを検討させる。